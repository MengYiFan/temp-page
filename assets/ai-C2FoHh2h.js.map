{"version":3,"file":"ai-C2FoHh2h.js","sources":["../../src/utils/ai.ts"],"sourcesContent":["import { Player } from '../stores/gameStore'\r\n\r\nconst BOARD_SIZE = 15\r\n\r\n// 评分权重\r\nconst WEIGHTS = {\r\n  FIVE: 100000,      // 五连\r\n  FOUR: 10000,       // 四连\r\n  THREE: 1000,       // 三连\r\n  TWO: 100,          // 二连\r\n  ONE: 10,           // 一连\r\n  BLOCKED_FOUR: 5000, // 被堵的四连\r\n  BLOCKED_THREE: 500, // 被堵的三连\r\n  BLOCKED_TWO: 50,   // 被堵的二连\r\n}\r\n\r\n// 获取某个方向上的连续棋子数\r\nfunction getLine(board: Player[][], row: number, col: number, dx: number, dy: number, player: Player): number {\r\n  let count = 0\r\n  let r = row + dx\r\n  let c = col + dy\r\n  \r\n  while (r >= 0 && r < BOARD_SIZE && c >= 0 && c < BOARD_SIZE && board[r][c] === player) {\r\n    count++\r\n    r += dx\r\n    c += dy\r\n  }\r\n  \r\n  return count\r\n}\r\n\r\n// 获取某个位置的评分\r\nfunction getPositionScore(board: Player[][], row: number, col: number, player: Player): number {\r\n  if (board[row][col] !== null) return 0\r\n  \r\n  let score = 0\r\n  const directions = [\r\n    [0, 1], [1, 0], [1, 1], [1, -1]\r\n  ]\r\n  \r\n  for (const [dx, dy] of directions) {\r\n    const leftCount = getLine(board, row, col, -dx, -dy, player)\r\n    const rightCount = getLine(board, row, col, dx, dy, player)\r\n    const totalCount = leftCount + rightCount + 1\r\n    \r\n    // 检查是否被堵\r\n    const leftBlocked = row - dx * (leftCount + 1) < 0 || \r\n                       row - dx * (leftCount + 1) >= BOARD_SIZE ||\r\n                       col - dy * (leftCount + 1) < 0 || \r\n                       col - dy * (leftCount + 1) >= BOARD_SIZE ||\r\n                       board[row - dx * (leftCount + 1)][col - dy * (leftCount + 1)] !== null\r\n    \r\n    const rightBlocked = row + dx * (rightCount + 1) < 0 || \r\n                        row + dx * (rightCount + 1) >= BOARD_SIZE ||\r\n                        col + dy * (rightCount + 1) < 0 || \r\n                        col + dy * (rightCount + 1) >= BOARD_SIZE ||\r\n                        board[row + dx * (rightCount + 1)][col + dy * (rightCount + 1)] !== null\r\n    \r\n    const blocked = leftBlocked && rightBlocked\r\n    \r\n    if (totalCount >= 5) {\r\n      score += WEIGHTS.FIVE\r\n    } else if (totalCount === 4) {\r\n      score += blocked ? WEIGHTS.BLOCKED_FOUR : WEIGHTS.FOUR\r\n    } else if (totalCount === 3) {\r\n      score += blocked ? WEIGHTS.BLOCKED_THREE : WEIGHTS.THREE\r\n    } else if (totalCount === 2) {\r\n      score += blocked ? WEIGHTS.BLOCKED_TWO : WEIGHTS.TWO\r\n    } else if (totalCount === 1) {\r\n      score += WEIGHTS.ONE\r\n    }\r\n  }\r\n  \r\n  return score\r\n}\r\n\r\n// 获取最佳移动位置\r\nexport function getBestMove(board: Player[][], aiPlayer: Player, difficulty: 'easy' | 'medium' | 'hard' | 'expert'): { row: number; col: number } {\r\n  let bestScore = -Infinity\r\n  let bestMove = { row: 7, col: 7 } // 默认中心位置\r\n  \r\n  const opponent = aiPlayer === 'black' ? 'white' : 'black'\r\n  \r\n  // 简单难度：随机选择\r\n  if (difficulty === 'easy') {\r\n    const availableMoves: { row: number; col: number }[] = []\r\n    \r\n    for (let row = 0; row < BOARD_SIZE; row++) {\r\n      for (let col = 0; col < BOARD_SIZE; col++) {\r\n        if (board[row][col] === null) {\r\n          availableMoves.push({ row, col })\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (availableMoves.length > 0) {\r\n      const randomIndex = Math.floor(Math.random() * availableMoves.length)\r\n      return availableMoves[randomIndex]\r\n    }\r\n    return bestMove\r\n  }\r\n  \r\n  // 中等及以上难度：使用评分算法\r\n  for (let row = 0; row < BOARD_SIZE; row++) {\r\n    for (let col = 0; col < BOARD_SIZE; col++) {\r\n      if (board[row][col] === null) {\r\n        // 检查是否能直接获胜\r\n        const winScore = getPositionScore(board, row, col, aiPlayer)\r\n        if (winScore >= WEIGHTS.FIVE) {\r\n          return { row, col }\r\n        }\r\n        \r\n        // 检查是否需要阻止对手获胜\r\n        const blockScore = getPositionScore(board, row, col, opponent)\r\n        if (blockScore >= WEIGHTS.FIVE) {\r\n          return { row, col }\r\n        }\r\n        \r\n        // 计算综合评分\r\n        let totalScore = winScore + blockScore * 0.8\r\n        \r\n        // 困难难度：考虑更多因素\r\n        if (difficulty === 'hard' || difficulty === 'expert') {\r\n          // 添加位置偏好（中心位置更优）\r\n          const centerDistance = Math.abs(row - 7) + Math.abs(col - 7)\r\n          const positionBonus = Math.max(0, 10 - centerDistance)\r\n          totalScore += positionBonus\r\n          \r\n          // 专家难度：更深层次的策略\r\n          if (difficulty === 'expert') {\r\n            // 考虑创造多个威胁\r\n            const aiScore = getPositionScore(board, row, col, aiPlayer)\r\n            const opponentScore = getPositionScore(board, row, col, opponent)\r\n            \r\n            if (aiScore >= WEIGHTS.FOUR) totalScore += 1000\r\n            if (opponentScore >= WEIGHTS.FOUR) totalScore += 800\r\n            if (aiScore >= WEIGHTS.THREE) totalScore += 100\r\n            if (opponentScore >= WEIGHTS.THREE) totalScore += 80\r\n          }\r\n        }\r\n        \r\n        if (totalScore > bestScore) {\r\n          bestScore = totalScore\r\n          bestMove = { row, col }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  return bestMove\r\n}"],"names":["WEIGHTS","FIVE","FOUR","THREE","TWO","ONE","BLOCKED_FOUR","BLOCKED_THREE","BLOCKED_TWO","getLine","board","row","col","dx","dy","player","count","r","c","BOARD_SIZE","getPositionScore","score","directions","leftCount","rightCount","totalCount","leftBlocked","rightBlocked","blocked","getBestMove","aiPlayer","difficulty","bestScore","bestMove","opponent","availableMoves","push","length","randomIndex","Math","floor","random","winScore","blockScore","totalScore","centerDistance","abs","positionBonus","max","aiScore","opponentScore"],"mappings":"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"}